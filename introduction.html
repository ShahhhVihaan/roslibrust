<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Introduction - RosLibRust Guides</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">RosLibRust Guides</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>RosLibRust is an alternative to the various existing ROS clients.
RosLibRust may be a great fit for your project, or you may benefit from one of the other existing clients.</p>
<ul>
<li><a href="https://github.com/ros2-rust/ros2_rust">ros2rust</a> is ideal if you want to release ROS2 packages to the community, or want to add Rust to an existing ROS2 project. But requires a full ROS2 installation.</li>
<li><a href="https://github.com/adnanademovic/rosrust">rosrust</a> is a solid ROS1 option, but doesn't support <code>async</code> and is un-maintained.</li>
<li><a href="https://docs.rs/ros2-client/latest/ros2_client/">ros2_client</a> is a pure rust client for ROS2 that supports <code>async</code>. However, it can only talk DDS and not Zenoh that ROS2 is migrating to.</li>
</ul>
<p>RosLibRust is ideal for systems like facility control systems and cloud tools that need to interact with a variety of ROS systems, and don't want to "become ROS" themselves.
RosLibRust has one API that supports a broad range of ROS versions and protocols.</p>
<h2 id="why-was-roslibrust-created"><a class="header" href="#why-was-roslibrust-created">Why was RosLibRust created?</a></h2>
<p>RosLibRust was designed to help solve several challenges in the ROS ecosystem:</p>
<ol>
<li>The need for <code>async</code> clients. At the time RosLibRust was written there was no <code>async</code> for ROS1 at all.</li>
<li>The need for pure rust clients.
<ol>
<li>RosLibRust nodes can be built on a system with only a rust compiler. Official rust docker images are <a href="https://hub.docker.com/_/rust">~500mb</a>.</li>
<li>Once compiled a RosLibRust node is a fully statically linked executable that can be run on any system. A RosLibRust ros1 publisher node is &lt;10MB compiled and can be deployed in 5MB alpine docker image. Show me any other ROS node that I can deploy in &lt;15 MB of size.</li>
</ol>
</li>
<li>The ROS1 -&gt; ROS2 migration was painful. While many concepts in ROS remained very similar, the API and build changes were invasive. A API abstraction layer should have made this easier.</li>
<li>ROS is pretty painful for both Unit and Integration testing.</li>
</ol>
<h2 id="how-does-roslibrust-solve-these-problems"><a class="header" href="#how-does-roslibrust-solve-these-problems">How does RosLibRust solve these problems?</a></h2>
<p>At a high level what RosLibRust provides is:</p>
<ul>
<li><a href="#an-abstract-api-for-ros">An abstract API for ROS</a></li>
<li><a href="#backend-implementations">Implementations of the abstract API for ROS1, ROS2, and rosbridge</a></li>
<li><a href="#mock-implementation-for-testing">A mock implementation of ROS for testing that allows deterministic "time traveling" tests</a></li>
<li><a href="#pure-rust-type-generation">Pure rust generation of types from ROS's .msg/.srv files that is ROS version agnostic</a></li>
</ul>
<p>These combine to make RosLibRust a powerful tool for building ROS nodes in rust.</p>
<h3 id="an-abstract-api-for-ros"><a class="header" href="#an-abstract-api-for-ros">An Abstract API for ROS</a></h3>
<p>At the heart of RosLibRust is a set of traits that define the API for interacting with ROS.
These traits are defined in the <a href="https://docs.rs/roslibrust_common/latest/roslibrust_common/">roslibrust_common</a> crate.</p>
<p>The most core trait is called <a href="https://docs.rs/roslibrust_common/latest/roslibrust_common/traits/trait.Ros.html">Ros</a>:</p>
<pre><code class="language-rust ignore">/// Represents all "standard" ROS functionality generically supported by roslibrust
///
/// Implementors of this trait behave like typical ROS node handles.
/// Cloning the handle does not create additional underlying connections, but instead simply returns another handle
/// to interact with the underlying node.
///
/// Implementors of this trait are expected to be "self de-registering", when the last node handle for a given
/// node is dropped, the underlying node is expected to be shut down and clean-up after itself
pub trait Ros: 'static + Send + Sync + TopicProvider + ServiceProvider + Clone {}</code></pre>
<p>This trait was designed to mimic how "Node Handles" work.
Breaking down this trait:</p>
<ul>
<li><code>'static</code> - Something implementing this trait holds no references to non-static data. Making its lifetime very safe.</li>
<li><code>Send</code> + <code>Sync</code> - Something implementing this trait is safe to send and <em>use</em> between threads.</li>
<li><code>Clone</code> - Something implementing this trait can be cloned, this allows us to make more handles and distribute them amongst our node.</li>
<li><code>TopicProvider</code> - Is another trait in roslibrust that allows us to create publishers and subscribers.</li>
<li><code>ServiceProvider</code> - Is another trait in roslibrust that allows us to create service clients and servers.</li>
</ul>
<p>Taking a look at the <a href="https://docs.rs/roslibrust_common/latest/roslibrust_common/traits/trait.TopicProvider.html">TopicProvider</a> trait:</p>
<pre><code class="language-rust ignore">/// This trait generically describes the capability of something to act as an async interface to a set of topics
///
/// This trait is largely based on ROS concepts, but could be extended to other protocols / concepts.
/// Fundamentally, it assumes that topics are uniquely identified by a string name (likely an ASCII assumption is buried in here...).
/// It assumes topics only carry one data type, but is not expected to enforce that.
/// It assumes that all actions can fail due to a variety of causes, and by network interruption specifically.
pub trait TopicProvider {
    // These associated types makeup the other half of the API
    // They are expected to be "self-deregistering", where dropping them results in unadvertise or unsubscribe operations as appropriate
    // We require Publisher and Subscriber types to be Send + 'static so they can be sent into different tokio tasks once created
    type Publisher&lt;T: RosMessageType&gt;: Publish&lt;T&gt; + Send + 'static;
    type Subscriber&lt;T: RosMessageType&gt;: Subscribe&lt;T&gt; + Send + 'static;

    /// Advertises a topic to be published to and returns a type specific publisher to use.
    ///
    /// The returned publisher is expected to be "self de-registering", where dropping the publisher results in the appropriate unadvertise operation.
    fn advertise&lt;T: RosMessageType&gt;(
        &amp;self,
        topic: &amp;str,
    ) -&gt; impl Future&lt;Output = Result&lt;Self::Publisher&lt;T&gt;&gt;&gt; + Send;

    /// Subscribes to a topic and returns a type specific subscriber to use.
    ///
    /// The returned subscriber is expected to be "self de-registering", where dropping the subscriber results in the appropriate unsubscribe operation.
    fn subscribe&lt;T: RosMessageType&gt;(
        &amp;self,
        topic: &amp;str,
    ) -&gt; impl Future&lt;Output = Result&lt;Self::Subscriber&lt;T&gt;&gt;&gt; + Send;
}</code></pre>
<p>We see a fairly advanced trait by Rust standards, with the following key features:</p>
<ul>
<li>We leverage Rust's <a href="https://blog.logrocket.com/using-rust-gats-improve-code-app-performance/">Generic Associated Types (GATs)</a> to define the Publisher and Subscriber types returned by the trait functions.
This means that the type (including the size) that a given implementation returns is completely different from other implementations.
The only requirement is the type implements the <a href="https://docs.rs/roslibrust_common/latest/roslibrust_common/traits/trait.Publish.html">Publish</a> and <a href="https://docs.rs/roslibrust_common/latest/roslibrust_common/traits/trait.Subscribe.html">Subscribe</a> traits.</li>
<li>While at first glance they might not look like it. The <code>advertise</code> and <code>subscribe</code> functions are actually <code>async fn</code> and return Futures.
This means we don't have to block our application on waiting for a connection to be established.</li>
<li>The advertise and subscribe functions are further generic over the message type. This is familiar to ROS users, but further compounds the complexity of the trait.</li>
</ul>
<p>To finish the chain let's look at one more trait, <a href="https://docs.rs/roslibrust_common/latest/roslibrust_common/traits/trait.Publish.html">Publish</a>:</p>
<pre><code class="language-rust ignore">/// Indicates that something is a publisher and has our expected publish
/// Implementors of this trait are expected to auto-cleanup the publisher when dropped
pub trait Publish&lt;T: RosMessageType&gt; {
    // Note: this is really just syntactic de-sugared `async fn`
    // However see: https://blog.rust-lang.org/2023/12/21/async-fn-rpit-in-traits.html
    // This generates a warning is rust as of writing due to ambiguity around the "Send-ness" of the return type
    // We only plan to work with multi-threaded work stealing executors (e.g. tokio) so we're manually specifying Send
    fn publish(&amp;self, data: &amp;T) -&gt; impl Future&lt;Output = Result&lt;()&gt;&gt; + Send;
}</code></pre>
<p>Publish finally provides the <code>publish</code> function that we use to send messages on a topic, which is again <code>async</code> and generic over the message type.
The combination of these traits is fairly complicated, but at the end of the day enables us to write code that is extremely agnostic to the underlying ROS implementation.
Furthermore, there is <strong>NO PERFORMANCE PENALTY</strong> for this abstraction.
Due to how monomorphic generics work in rust the compiler is able to completely erase the generic types at compile time, and optimize the code as if we had written it directly for the specific type.</p>
<p>What's the catch? Slightly worse compile times, but you only pay for what you use.
If you create a generic node that uses the <code>Ros</code> trait, and use it with multiple backend implementations,
there will be separate compilations of the node for each backend.</p>
<h3 id="backend-implementations"><a class="header" href="#backend-implementations">Backend Implementations</a></h3>
<p>Okay so RosLibRust has this abstract API? How can we actually use it?</p>
<p>RosLibRust provides several implementations of the <code>Ros</code> trait:</p>
<ul>
<li><a href="https://docs.rs/roslibrust_ros1/latest/roslibrust_ros1/">roslibrust_ros1</a> - Implements the TCPROS protocol that was the backbone of ROS1</li>
<li><a href="https://docs.rs/roslibrust_zenoh/latest/roslibrust_zenoh/">roslibrust_zenoh</a> - Implements a variant of ROS1 communication used by <a href="https://github.com/eclipse-zenoh/zenoh-plugin-ros1">zenoh-ros1-bridge</a></li>
<li><a href="https://docs.rs/roslibrust_rosbridge/latest/roslibrust_rosbridge/">roslibrust_rosbridge</a> - Implements the <a href="https://github.com/RobotWebTools/rosbridge_suite">rosbridge_suite</a> websocket protocol</li>
<li>COMING SOON <a href="https://docs.rs/roslibrust_ros2/latest/roslibrust_ros2/">roslibrust_ros2</a> - Implements the Zenoh communication used by <a href="https://github.com/ros2/rmw_zenoh">rmw_zenoh</a> in ROS2 from Kilted onwards</li>
<li><a href="https://docs.rs/roslibrust_mock/latest/roslibrust_mock/">roslibrust_mock</a> - Implements a mock ROS perfect for testing</li>
</ul>
<p>Typically we don't depend on these crates directly, but instead use them by enabling their corresponding features on <code>roslibrust</code>.</p>
<pre><code class="language-toml">[dependencies]
roslibrust = { version = "0.15", features = ["ros1"] }
</code></pre>
<p>The full list of features is:</p>
<ul>
<li><code>ros1</code> - Enables the <a href="https://docs.rs/roslibrust_ros1/latest/roslibrust_ros1/">roslibrust_ros1</a> backend</li>
<li><code>zenoh</code> - Enables the <a href="https://docs.rs/roslibrust_zenoh/latest/roslibrust_zenoh/">roslibrust_zenoh</a> backend</li>
<li><code>rosbridge</code> - Enables the <a href="https://docs.rs/roslibrust_rosbridge/latest/roslibrust_rosbridge/">roslibrust_rosbridge</a> backend</li>
<li><code>mock</code> - Enables the <a href="https://docs.rs/roslibrust_mock/latest/roslibrust_mock/">roslibrust_mock</a> backend</li>
<li><code>ros2</code> - COMING SOON Enables the <a href="https://docs.rs/roslibrust_ros2/latest/roslibrust_ros2/">roslibrust_ros2</a> backend</li>
<li><code>codegen</code> - Provides access to the <a href="https://docs.rs/roslibrust_codegen/latest/roslibrust_codegen/">roslibrust_codegen</a> crate for generating ROS message types in build.rs.</li>
<li><code>macro</code> - Provides access to the <a href="https://docs.rs/roslibrust_codegen_macro/latest/roslibrust_codegen_macro/">roslibrust_codegen_macro</a> crate for generating ROS message types using a proc-macro.</li>
<li><code>all</code> - Enables all of the above features.</li>
</ul>
<h3 id="pure-rust-type-generation"><a class="header" href="#pure-rust-type-generation">Pure Rust Type Generation</a></h3>
<p>RosLibRust has implemented a full parser and code-generator for ROS message types.
This allows us to generate Rust types from ROS .msg/.srv files at compile time.
The generated types are fully compatible with all RosLibRust backends.
Meaning a ROS1 .msg file can be used with ROS2 and vice versa.</p>
<p>The rosbridge backend support "generic" types with parsing fallbacks, see <a href="https://github.com/RosLibRust/roslibrust/blob/master/roslibrust/examples/generic_message.rs">generic message example</a></p>
<p>A <code>build.rs</code> file can be used to automatically generate Rust types at build time from ROS .msg/.srv files.
See <a href="https://github.com/RosLibRust/roslibrust/tree/master/example_package">example_package</a> for a full example.</p>
<p>A proc-macro is also provided for generating types at compile time, see <a href="https://github.com/RosLibRust/roslibrust/tree/master/example_package_macro">example_package_macro</a> for an example.</p>
<p>This breaks tooling free from needing any ROS installation.</p>
<h3 id="mock-implementation-for-testing"><a class="header" href="#mock-implementation-for-testing">Mock Implementation for Testing</a></h3>
<p>A major challenge for incorporating ROS into larger systems is testing.
Traditionally testing ROS nodes involves either:</p>
<ol>
<li>Breaking all the "ROS Logic" and other logic apart and indpendently testing them.</li>
<li>Launching a full ROS system in a testing environment and interacting with it.</li>
</ol>
<p>The first approach leads to "extra abstraction" and often causes timing and messaging related bugs to be missed.
The second approach is brittle, slow, and often a bottle neck for test times.</p>
<p>RosLibRust provides a mock implementation of ROS for testing that allows deterministic "time traveling" tests.
See <a href="extended_getting_started.html#writing-tests-for-our-node">extended getting started guide</a> for an example.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="extended_getting_started.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="extended_getting_started.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
